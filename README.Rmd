---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-"
)
```

# bitflyer 

[![Build Status](https://travis-ci.org/teramonagi/bitflyer.svg?branch=master)](https://travis-ci.org/teramonagi/bitflyer)

R wrapper for [bitFlyer's API](https://lightning.bitflyer.com/docs/api)

## Installation

```{r gh-installation, eval = FALSE}
install.packages("bitflyer")

# Or the development version from GitHub:
# install.packages("devtools")
devtools::install_github("teramonagi/bitflyer")
```

## Preparation of API keys
bitFlyer Private APIs require authentication using an API Key and API Secret. 
They can be obtained by generating them on the [developer's page](https://lightning.bitflyer.com/developer).

You must set these keys in `.Renviron`
```
‚ùØ cat ~/.Renviron 
BITFLYER_LIGHTNING_API_KEY=<your-api-key>
BITFLYER_LIGHTNING_API_SECRET=<your-api-secret>
```
or as global variables in R
```
> BITFLYER_LIGHTNING_API_KEY <- "your-api-key"
> BITFLYER_LIGHTNING_API_SECRET <- "your-api-secret"
```

## Example

### HTTP API
#### [HTTP Public API](https://lightning.bitflyer.com/docs/api#http-public-api)

```{r public_api}
library("bitflyer")
# Get the list of market
fromJSON(get_markets())

# Get order book
x <- board(product_code = "BTC_JPY")
x <- fromJSON(x)
str(x)

# Get the current status of the exchange.
get_health()

# ... etc
```

- [HTTP Private API](https://lightning.bitflyer.com/docs/api#http-private-api)

```{r private_api}
# Get a list of which HTTP Private APIs can be used with the specified API key
fromJSON(get_permissions())

# Get Margin Status
get_collateral()

#Send a New Order
x <- send_child_order(
  product_code = "BTC_JPY", 
  child_order_type = "LIMIT", 
  side = "BUY", 
  price = 300*10^4, 
  size = 0.001
)
x
child_order_acceptance_id <- fromJSON(x)$child_order_acceptance_id

# List Orders
fromJSON(get_child_orders(product_code = "BTC_JPY", child_order_acceptance_id=child_order_acceptance_id))
# You can also get all active orders
# fromJSON(get_child_orders(product_code = "BTC_JPY", child_order_state="ACTIVE"))

# Cancel the order
cancel_child_order(product_code = "BTC_JPY", child_order_acceptance_id = child_order_acceptance_id)
# No active orders
fromJSON(get_child_orders(product_code = "BTC_JPY", child_order_state="ACTIVE"))

# Get Trading Commission
get_trading_commission(product_code = "BTC_JPY")

# ... etc
```

### Realtime API
... under development ...
